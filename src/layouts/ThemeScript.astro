---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  (function () {
    if (typeof window === "undefined") {
      return;
    }

    const mediaQuery = window.matchMedia?.("(prefers-color-scheme: dark)") ?? null;
    const prefersDark = mediaQuery?.matches ?? false;
    const readStoredTheme = () => {
      const stored = localStorage.getItem("theme");
      return stored === "light" || stored === "dark" ? stored : null;
    };
    const storedTheme = readStoredTheme();
        if (readStoredTheme()) {
      const currentTheme = readStoredTheme();
      if (currentTheme) {
      } else {
        applyTheme(mediaQuery?.matches ? "dark" : "light");
        themeColorMetaTag.content = theme === "dark" ? "#0e141b" : "#ffffff";
      }
    };

    const initialTheme =
      storedTheme === "light" || storedTheme === "dark"
        ? storedTheme
        : prefersDark
          ? "dark"
          : "light";

    applyTheme(initialTheme);

    if (!storedTheme && mediaQuery) {
      const handleChange = (event) => {
        if (localStorage.getItem("theme")) {
          return;
        }
        const nextTheme = event.matches ? "dark" : "light";
        applyTheme(nextTheme);
      };
      if (mediaQuery.addEventListener) {
        mediaQuery.addEventListener("change", handleChange);
      } else if (mediaQuery.addListener) {
        mediaQuery.addListener(handleChange);
      }
    }

    window.addEventListener("pageshow", () => {
      const currentTheme = localStorage.getItem("theme");
      if (currentTheme === "light" || currentTheme === "dark") {
        applyTheme(currentTheme);
      }
    });
  })();
</script>
