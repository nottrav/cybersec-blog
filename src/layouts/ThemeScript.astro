---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  (function () {
    if (typeof window === "undefined") {
      return;
    }

    const themeColorMetaTag = document.head.querySelector(
      'meta[name="theme-color"]'
    );
    const readStorageValue = (storage: Storage | null) => {
      if (!storage) {
        return null;
      }
      try {
        return storage.getItem("theme");
      } catch {
        return null;
      }
    };
    const isValidTheme = (value: string | null) =>
      value === "light" || value === "dark";
    const sessionTheme = readStorageValue(window.sessionStorage);
    let storedTheme = readStorageValue(window.localStorage);

    if (!isValidTheme(storedTheme) && isValidTheme(sessionTheme)) {
      storedTheme = sessionTheme;
      try {
        window.localStorage.setItem("theme", sessionTheme as string);
      } catch {
        // ignore storage write errors
      }
    }
    const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)")
      ?.matches;
    const initialTheme =
      storedTheme === "light" || storedTheme === "dark"
        ? storedTheme
        : prefersDark
          ? "dark"
          : "light";

    if (initialTheme === "dark") {
      document.documentElement.classList.add("dark");
      if (themeColorMetaTag) {
        themeColorMetaTag.content = "#0e141b";
      }
    } else {
      document.documentElement.classList.remove("dark");
      if (themeColorMetaTag) {
        themeColorMetaTag.content = "#ffffff";
      }
    }

    if (!storedTheme && window.matchMedia) {
      const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
      mediaQuery.addEventListener("change", (event) => {
        if (readStorageValue(window.localStorage)) {
          return;
        }
        const nextTheme = event.matches ? "dark" : "light";
        document.documentElement.classList.toggle("dark", nextTheme === "dark");
        if (themeColorMetaTag) {
          themeColorMetaTag.content =
            nextTheme === "dark" ? "#0e141b" : "#ffffff";
        }
      });
    }
  })();
</script>
