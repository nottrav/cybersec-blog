---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  // Set initial mode based on stored preference or system setting
  (function () {
    try {
      if (typeof window === "undefined") return;
      const themeColorMeta = document.querySelector('meta[name="theme-color"]');
      const storedTheme = localStorage.getItem("theme");
      const savedMode =
        storedTheme === "dark" || storedTheme === "light" || storedTheme === "system"
          ? storedTheme
          : "system";
      const prefersDark = window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      const effectiveTheme =
        savedMode === "system"
          ? prefersDark
            ? "dark"
            : "light"
          : savedMode;

      document.documentElement.classList.toggle("dark", effectiveTheme === "dark");
      document.documentElement.dataset.theme = savedMode;
      if (themeColorMeta) {
        themeColorMeta.content =
          effectiveTheme === "dark" ? "#201b25" : "#f2ebfa";
      }

      if (!storedTheme || storedTheme !== savedMode) {
        localStorage.setItem("theme", savedMode);
      }
    } catch (e) {
      // no-op
    }
  })();
</script>
